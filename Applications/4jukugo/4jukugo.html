<!doctype html>
<html>
<head>
    <title>似非四字熟語</title>
    <meta charset="UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js" type="text/javascript"></script>
    <script src="jquery.jmp3.js" type="text/javascript"></script>
    <script type="text/javascript">
var jukugoList = [
"配信充実",
"聖夜中止",
"Ｑ４結構",
"万歩挑戦",
"多重視聴",
"字幕少女",
"四字熟語",
"風来飛鳥",
"七大驚異",
"大魔界村",
"海腹川背",
"実況配信",
"直下切断",
"二次元嫁",
"非現実充",
"友達不在",
"自家発電",
"自宅警備",
"信長野望",
"机山登山",
"過疎配信",
"帯域測定",
"専板登録",
"裏白蛇島",
"年末駅伝",
"主括弧笑",
"何実追放",
"支持厨求",
"無双三段",
"弟切合成",
"夏之思出",
"現実逃避",
"ぴあかす",
"限界突破",
"金田朋子",
"豊崎愛生",
"水樹奈々",
"堀江由衣",
"名塚佳織",
"新谷良子",
"後藤邑子",
"新井里美",
"牧野由依",
"皆口裕子",
"茅原実里",
"田中理恵",
"阿澄佳奈",
"植田佳奈",
"今井麻美",
"桑島法子",
"松来未祐",
"下田麻美",
"中原麻衣",
"今井麻美",
"浅野真澄",
"川澄綾子",
"井口裕香",
"花澤香菜",
"水無灯里",
"田井中律",
"長門有希",
"逢坂大河",
"神尾観鈴",
"上条当麻",
"御坂美琴",
"白井黒子",
"月詠小萌",
"初春飾利",
"佐天涙子",
"古泉一樹",
"朝倉涼子",
"岡崎朋也",
"坂上智代",
"綾波レイ",
"碇シンジ",
"神山満月",
"月宮あゆ",
"水瀬名雪",
"浦飯幽助",
"けいおん",
"ぽてまよ",
"みなみけ",
"マブラヴ",
"まぶらほ",
"まほらば",
"ラブひな",
"ひだまり",
"なるたる",
"ぽぽたん",
"ましまろ",
"ぼくらの",
"らきすた",
"もえたん",
"シゴフミ",
"かのこん",
"あまつき",
"セキレイ",
"かんなぎ",
"とらドラ",
"かなめも",
"うたかた",
"バカテス",
"瓶詰妖精",
"禁書目録",
"超電磁砲",
"偵都横浜",
"地獄少女",
"一騎当千",
"Ｂ型Ｈ系",
"特務機関",
"庵野秀明",
"補完計画",
"ＳＯＳ団",
"禁則事項",
"閉鎖空間",
"幻想御手",
"虚数学区",
"大覇星祭",
"学園都市",
"一方通行",
"桂木桂馬",
"落とし神",
"キャス子",
"なるたん",
"にゃーこ",
"十四型乙",
"幼女虐待",
"配信自重",
"仮面様乙",
"お絵描き",
"ゴミスレ",
"安価募集",
"きのこ狩",
"アンサガ",
"いちょつ",
"テステス",
"トカゲ鯖",
"ポート０",
"ＰＣ殴る",
"ぺかれこ",
"バッファ",
"リスナー",
"時間泥棒",
"録画禁止",
"ＢＵＭＰ",
"僧侶即死",
"スカイプ",
"オプーナ",
"七人ＴＡ",
"就職薄望",
"深夜営業",
"ぷよフィ",
"志村後ろ",
"高橋名人",
"毛利名人",
"ＹＰ４Ｇ",
"裏白駅伝",
"塵箱雷舞",
"忍忍賢賢",
"ＰＣＹＰ",
"視聴者数",
"ゼノ信者",
];
        
        var hoverCss = {
            border : "1px solid #000",
            padding : "0px"
        };

        var unhoverCss = {
            padding : "1px",
            border : "none",
        };
        
        var JUKUGO_WIDTH = 56;
        var JUKUGO_HEIGHT = 41;
        var MARGIN_LEFT = 20;
        var MARGIN_TOP = 15;

        var src0 = "SOUND/4jukugo0.mp3";
        var src1 = "SOUND/4jukugo1.mp3";
        var src2 = "SOUND/4jukugo2.mp3";
        var src3 = "SOUND/4jukugo3.mp3";
        var src4 = "SOUND/4jukugo4.mp3";
        
        var audio0 = new Audio();
        var audio1 = new Audio();
        var audio2 = new Audio();
        var audio3 = new Audio();
        var audio4 = new Audio();

        var JUKUGO_LENGTH = 4;
        var MAX_STAGE = 7;
        var numList = [0, 4, 6, 8, 10, 12, 14, 16];


        function selectAnswer(num) {
            var answer = new Array();
            var start = 0;
            for (var i = 0; i < stage; i ++) {
                start += numList[i];
            }
            for (var i = start; i < num + start; i ++) {
                answer.push(jukugoList[i]);
            }
            return answer;
        }

        function shuffleList() {
            for (var i = 0; i < jukugoList.length; i++){
                var tmpA, tmpB, rnd;
                var rnd = Math.floor(Math.random() * jukugoList.length);
                tmpA = jukugoList[i];
                tmpB = jukugoList[rnd];
                jukugoList[i] = tmpB;
                jukugoList[rnd] = tmpA;
            }
        }
        
        function shuffleAnswer(answer) {
            var list = new Array();
            for (var i = 0; i < answer.length; i ++) {
                for (var j = 0; j < JUKUGO_LENGTH; j ++) {
                    list.push(answer[i].charAt(j));
                }
            }
            for (var i = 0; i < list.length; i++){
                var tmpA, tmpB, rnd;
                var rnd = Math.floor(Math.random() * list.length);
                tmpA = list[i];
                tmpB = list[rnd];
                list[i] = tmpB;
                list[rnd] = tmpA;
            }
            var shuffle = new Array();
            for (var i = 0; i < answer.length; i ++) {
                var s = "";
                for (var j = 0; j < JUKUGO_LENGTH; j ++) {
                    s += list[i * JUKUGO_LENGTH + j];
                }
                shuffle.push(s);
            }
            return shuffle;
        }

        var stage;
        function init($) {
            $(".kanji").remove();
            $("#clearTxt").html("GAME<br />START");
            $("#table").css({
                display:"none"
            });
            $("#tableBack").css({
                display:"none"
            });
            stage = 0;
            shuffleList();
            opening($);
        }

        function opening($) {
            $("#container").css({background:"url(opening.png) bottom left no-repeat"});
            $("#clear").css({display:"block"});
        }

        function ending($) {
            $(".kanji").remove();
            $("#table").css({
                display:"none"
            });
            $("#tableBack").css({
                display:"none"
            });

            $("#container").fadeOut("slow");

            var endFunc = function(){
                $("#container").css({background:"url(ending.png) bottom left no-repeat"});
                $("#container").fadeIn("slow");
                audio4.play();
            }
            var tid=setTimeout(endFunc,1000);
        }

        function start($) {
            $(".kanji").remove();
            var num = numList[stage];
            var answer = selectAnswer(num);
            var shuffle = shuffleAnswer(answer);
            var isAnswered = {};

            $("#stage").text("STAGE" + stage);


            var selectedKanji = "";
            var num2 = 0;
            if (num > 8) {
                num2 = num / 2;
                num = num2;
            }
            for (var i = 0; i < num; i ++) {
                var jukugo = shuffle[i];
                for (var j = 0; j < JUKUGO_LENGTH; j ++) {
                    var kanji = "kanji_" + i + "_" + j;
                    isAnswered[kanji] = false;
                    $("#table").append("<div class=\"kanji\" id=\""+ kanji + "\">" + jukugo.charAt(j) + "</div>");
                    $("#" + kanji).css({left:(MARGIN_LEFT + i * JUKUGO_WIDTH), top:(MARGIN_TOP + j * JUKUGO_HEIGHT)});
                }
            }
            for (var i = 0; i < num2; i ++) {
                var jukugo = shuffle[i + num];
                for (var j = 0; j < JUKUGO_LENGTH; j ++) {
                    var kanji = "kanji_" + (i + num) + "_" + j;
                    isAnswered[kanji] = false;
                    $("#table").append("<div class=\"kanji\" id=\""+ kanji + "\">" + jukugo.charAt(j) + "</div>");
                    $("#" + kanji).css({left:(MARGIN_LEFT + i * JUKUGO_WIDTH), top:(MARGIN_TOP * 2 + (j + JUKUGO_LENGTH) * JUKUGO_HEIGHT)});
                }
            }
            
            
            var tableWidth = MARGIN_LEFT * 2 + (num - 1) * JUKUGO_WIDTH + 38;
            var tableHeight = MARGIN_TOP * 2 + JUKUGO_LENGTH * JUKUGO_HEIGHT;
            
            if (num2 > 0) { tableHeight += MARGIN_TOP + JUKUGO_LENGTH * JUKUGO_HEIGHT; }
            $("#table").css({
                width : tableWidth,
                height : tableHeight,
                left : (320 - tableWidth / 2),
                top : (210 - tableHeight / 2),
                display:"block"
            });
            $("#tableBack").css({
                width : tableWidth,
                height : tableHeight,
                left : (320 - tableWidth / 2),
                top : (210 - tableHeight / 2),
                display:"block"
            });

            $(".kanji").hover(
                function(){
                    var id = $(this).attr("id");
                    if(selectedKanji != id && !isAnswered[id]) {
                        $(this).css(hoverCss);
                    }
               },
               function(){
                    var id = $(this).attr("id");
                    if(selectedKanji != id && !isAnswered[id]) {
                        $(this).css(unhoverCss);
                    }
               }
            );
            


            $(".kanji").bind("click", function() {
                if (isAnswered[$(this).attr("id")]) { return; }
                audio1.play();

                if (selectedKanji == $(this).attr("id")) {
                    $(this).css(hoverCss);
                    $(this).css({background:"none", color:"black"});
                    selectedKanji = "";
                } else if (selectedKanji != "") {
                    var selectedId = "#" + selectedKanji;
                    var kanji1 = $(selectedId).text();
                    var kanji2 = $(this).text();
                    $(selectedId).text(kanji2);
                    $(this).text(kanji1);
                    $(selectedId).css({background:"none", color:"black"});
                    selectedKanji = "";
                    
                    
                    // 正答確認
                    var arg1 = $(selectedId).attr("id").split("_");
                    var arg2 = $(this).attr("id").split("_");
                    var i1 = arg1[1];
                    var i2 = arg2[1];
                    
                    var jukugo1 = "";
                    var jukugo2 = "";
                    for (var j = 0; j < JUKUGO_LENGTH; j ++) {
                        var kanjiId1 = "#kanji_" + i1 + "_" + j;
                        var kanjiId2 = "#kanji_" + i2 + "_" + j;
                        jukugo1 += $(kanjiId1).text();
                        jukugo2 += $(kanjiId2).text();
                    }

                    var isCorrect1 = false;
                    var isCorrect2 = false;
                    for (var i = 0; i < answer.length; i ++) {
                        if (answer[i] == jukugo1) { isCorrect1 = true; }
                        if (answer[i] == jukugo2) { isCorrect2 = true; }
                        if (isCorrect1 && isCorrect2) { break; }
                    }
                    
                    if (isCorrect1) {
                        for (var j = 0; j < JUKUGO_LENGTH; j ++) {
                            var kanji = "kanji_" + i1 + "_" + j;
                            var kanjiId = "#" + kanji;
                            $(kanjiId).css(unhoverCss);
                            $(kanjiId).css({backgroundColor:"#888", color:"white", cursor:"default"});
                            isAnswered[kanji] = true;
                        }
                    }
                    if (isCorrect2) {
                        for (var j = 0; j < JUKUGO_LENGTH; j ++) {
                            var kanji = "kanji_" + i2 + "_" + j;
                            var kanjiId = "#" + kanji;
                            $(kanjiId).css(unhoverCss);
                            $(kanjiId).css({backgroundColor:"#888", color:"white", cursor:"default"});
                            isAnswered[kanji] = true;
                        }
                    }
                    
                    // クリア確認
                    if (isCorrect1 || isCorrect2) {
                        audio0.play();
                        var isClear = true;
                        for (var i = 0; i < num + num2; i ++) {
                            for (var j = 0; j < JUKUGO_LENGTH; j ++) {
                                var kanji = "kanji_" + i + "_" + j;
                                if (!isAnswered[kanji]) {
                                    isClear = false;
                                    break;
                                }
                            }
                        }
                        
                        var clearFunc = function(){
                            for (var i = 0; i < num + num2; i ++) {
                                for (var j = 0; j < JUKUGO_LENGTH; j ++) {
                                    var kanji = "kanji_" + i + "_" + j;
                                    var kanjiId = "#" + kanji;
                                    $(kanjiId).css({background:"none", color:"black"});
                                }
                            }
                            $("#clear").css({display:"block"});
                            audio3.play();
                        }
                        if (isClear) { // DEBUG
                            var tid=setTimeout(clearFunc,500);
                        }
                    }
                } else {
                    selectedKanji = $(this).attr("id");
                    $(this).css(unhoverCss);
                    $(this).css({backgroundColor:"red", color:"white"});
                }
            });
        };
        
        
        $(function() {
            $("#reset").bind("click", function() {
                init($);
            });
            $("#clearTxt").bind("click", function() {
                $("#clear").css({display:"none"});
                $("#container").css({background:"url(casko.png) bottom left no-repeat"});
                stage ++;
                if (stage > MAX_STAGE) {
                    ending($);
                } else if (stage == MAX_STAGE) {
                    audio2.play();
                    $(this).html("GAME<br />CLEAR");
                    start($);
                } else {
                    audio2.play();
                    $(this).html("NEXT<br />STAGE");
                    start($);
                }
            });
            
            audio0.src = src0;
            audio1.src = src1;
            audio2.src = src2;
            audio3.src = src3;
            audio4.src = src4;
            audio0.load();
            audio1.load();
            audio2.load();
            audio3.load();
            audio4.load();

            init($);
        });


    </script>
    <style>
        li { list-style:none; }
        #container {
            border :1px solid #000;
            width  : 640px;
            height : 420px;
            margin : 50px;
            position: absolute;
            background:url(opening.png) bottom left no-repeat;
        }
        .kanji {
            width  : 38px;
            height : 38px;
            font-size : 38px;
            font-family: "ＭＳ 明朝",serif;
            font-weight:bold;
            position: absolute;
            padding:1px;
            cursor:pointer;
            margin:1px;
            text-align :center;
        }
        #table {
            position : absolute;
        }
        #tableBack {
            position : absolute;
            background-color : #FFF;
            opacity:0.9;
        }
        #reset {
            font-size:12px;
            font-weight:bold;
            font-family: "Arial Black",serif;
            color : #AAA;
            width:60px;
            text-align:center;
            right:0px;
            position:absolute;
            cursor:pointer;
        }
        #stage {
            font-size:12px;
            font-weight:bold;
            font-family: "Arial Black",serif;
            color : #AAA;
            width:60px;
            text-align:center;
            left:0px;
            position:absolute;
        }
        #clear {
            width:130px;
            height:132px;
            right:0px;
            bottom:0px;
            background:url("next.gif") no-repeat;
            position:absolute;
            text-align:right;
            display:none;
        }
        #clearTxt {
            line-height:25px;
            text-align:right;
            padding-right:20px;
            padding-top:50px;
            font-size:18px;
            font-weight:bold;
            font-family: "Arial",serif;
            color : #FFF;
            cursor:pointer;
            margin-left:40px;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="reset">RESET</div>
        <div id="stage"></div>
        <div id="tableBack"></div>
        <div id="table"></div>
        <div id="clear"><div id="clearTxt">GAME<br />START</div></div>
    </div>
    <img src="opening.png" style="width:1px;height:1px;" />
    <img src="casko.png" style="width:1px;height:1px;" />
</body>
</html>

      